{"ast":null,"code":"'use strict';\n\nvar packageJson = require('../../package.json');\nconst {\n  getBrowserOsDetails\n} = require('../_util');\nvar util = require('../_util');\nvar errors = require('./errors');\n\n/**\n * The driver's internal HTTP client.\n *\n * @constructor\n * @param {Object} options Same as the {@link Client} options.\n * @private\n */\nfunction HttpClient(options) {\n  var isHttps = options.scheme === 'https';\n\n  // If the port is a falsy value - replace it with default one.\n  if (!options.port) {\n    options.port = isHttps ? 443 : 80;\n  }\n\n  // HTTP2 adapter is applicable only if it's NodeJS env and\n  // no fetch API override provided (to preserve backward-compatibility).\n  var useHttp2Adapter = !options.fetch && util.isNodeEnv() && isHttp2Supported();\n  this._adapter = useHttp2Adapter ? new (require('./http2Adapter'))({\n    http2SessionIdleTime: options.http2SessionIdleTime\n  }) : new (require('./fetchAdapter'))({\n    isHttps: isHttps,\n    fetch: options.fetch,\n    keepAlive: options.keepAlive\n  });\n  if (options.endpoint === null) {\n    this._baseUrl = options.scheme + '://' + options.domain + ':' + options.port;\n  } else {\n    this._baseUrl = options.endpoint;\n  }\n  this._secret = options.secret;\n  this._headers = Object.assign({}, options.headers, getDefaultHeaders());\n  this._queryTimeout = options.queryTimeout;\n  this._lastSeen = null;\n  this._timeout = Math.floor(options.timeout * 1000);\n}\n\n/**\n * Returns last seen transaction time.\n *\n * @returns {number} The last seen transaction time.\n */\nHttpClient.prototype.getLastTxnTime = function () {\n  return this._lastSeen;\n};\n\n/**\n * Sets the last seen transaction if the given timestamp is greater than then\n * know last seen timestamp.\n *\n * @param {number} time transaction timestamp.\n */\nHttpClient.prototype.syncLastTxnTime = function (time) {\n  if (this._lastSeen == null || this._lastSeen < time) {\n    this._lastSeen = time;\n  }\n};\n\n/**\n * Cleans up any held resources.\n *\n * @param {?object} opts Close options.\n * @param {?boolean} opts.force Whether to force resources clean up.\n * @returns {Promise<void>}\n */\nHttpClient.prototype.close = function (opts) {\n  return this._adapter.close(opts);\n};\n\n/**\n * Executes an HTTP request.\n *\n * @param {?object} options Request parameters.\n * @param {?string} options.method Request method.\n * @param {?string} options.path Request path.\n * @param {?string} options.body Request body.\n * @param {?object} options.query Request query.\n * @params {?object} options.streamConsumer Stream consumer, if presented\n * the request will be \"streamed\" into streamConsumer.onData function.\n * @params {function} options.streamConsumer.onData Function called with a chunk of data.\n * @params {function} options.streamConsumer.onError Function called\n * when an error occurred.\n * when the stream is ended.\n * @param {?object} options.signal Abort signal object.\n * @param {?object} options.fetch Fetch API compatible function.\n * @param {?object} options.secret FaunaDB secret.\n * @param {?object} options.queryTimeout FaunaDB query timeout.\n * @returns {Promise} The response promise.\n */\nHttpClient.prototype.execute = function (options) {\n  options = options || {};\n  var invalidStreamConsumer = options.streamConsumer && (typeof options.streamConsumer.onData !== 'function' || typeof options.streamConsumer.onError !== 'function');\n  if (invalidStreamConsumer) {\n    return Promise.reject(new TypeError('Invalid \"streamConsumer\" provided'));\n  }\n  var secret = options.secret || this._secret;\n  var queryTimeout = options.queryTimeout || this._queryTimeout;\n  var headers = this._headers;\n  headers['Authorization'] = secret && secretHeader(secret);\n  headers['X-Last-Seen-Txn'] = this._lastSeen;\n  headers['X-Query-Timeout'] = queryTimeout;\n  return this._adapter.execute({\n    origin: this._baseUrl,\n    path: options.path || '/',\n    query: options.query,\n    method: options.method || 'GET',\n    headers: util.removeNullAndUndefinedValues(headers),\n    body: options.body,\n    signal: options.signal,\n    timeout: this._timeout,\n    streamConsumer: options.streamConsumer\n  });\n};\nfunction secretHeader(secret) {\n  return 'Bearer ' + secret;\n}\n\n/** @ignore */\nfunction getDefaultHeaders() {\n  var driverEnv = {\n    driver: ['javascript', packageJson.version].join('-')\n  };\n  var isServiceWorker;\n  try {\n    isServiceWorker = global instanceof ServiceWorkerGlobalScope;\n  } catch (error) {\n    isServiceWorker = false;\n  }\n  try {\n    if (util.isNodeEnv()) {\n      driverEnv.runtime = ['nodejs', process.version].join('-');\n      driverEnv.env = util.getNodeRuntimeEnv();\n      var os = require('os');\n      driverEnv.os = [os.platform(), os.release()].join('-');\n    } else if (isServiceWorker) {\n      driverEnv.runtime = 'Service Worker';\n    } else {\n      driverEnv.runtime = util.getBrowserDetails();\n      driverEnv.env = 'browser';\n      driverEnv.os = getBrowserOsDetails();\n    }\n  } catch (_) {}\n  var headers = {\n    'X-FaunaDB-API-Version': packageJson.apiVersion\n  };\n\n  // TODO: api cors must be enabled to accept header X-Driver-Env\n  if (util.isNodeEnv()) {\n    headers['X-Driver-Env'] = Object.keys(driverEnv).map(key => [key, driverEnv[key].toLowerCase()].join('=')).join('; ');\n  }\n  return headers;\n}\nfunction isHttp2Supported() {\n  try {\n    require('http2');\n    return true;\n  } catch (_) {\n    return false;\n  }\n}\nmodule.exports = {\n  HttpClient: HttpClient,\n  TimeoutError: errors.TimeoutError,\n  AbortError: errors.AbortError\n};","map":{"version":3,"names":["packageJson","require","getBrowserOsDetails","util","errors","HttpClient","options","isHttps","scheme","port","useHttp2Adapter","fetch","isNodeEnv","isHttp2Supported","_adapter","http2SessionIdleTime","keepAlive","endpoint","_baseUrl","domain","_secret","secret","_headers","Object","assign","headers","getDefaultHeaders","_queryTimeout","queryTimeout","_lastSeen","_timeout","Math","floor","timeout","prototype","getLastTxnTime","syncLastTxnTime","time","close","opts","execute","invalidStreamConsumer","streamConsumer","onData","onError","Promise","reject","TypeError","secretHeader","origin","path","query","method","removeNullAndUndefinedValues","body","signal","driverEnv","driver","version","join","isServiceWorker","global","ServiceWorkerGlobalScope","error","runtime","process","env","getNodeRuntimeEnv","os","platform","release","getBrowserDetails","_","apiVersion","keys","map","key","toLowerCase","module","exports","TimeoutError","AbortError"],"sources":["/Users/godfredakpan/Documents/signature_generator/signature_generator/node_modules/faunadb/src/_http/index.js"],"sourcesContent":["'use strict'\nvar packageJson = require('../../package.json')\nconst { getBrowserOsDetails } = require('../_util')\nvar util = require('../_util')\nvar errors = require('./errors')\n\n/**\n * The driver's internal HTTP client.\n *\n * @constructor\n * @param {Object} options Same as the {@link Client} options.\n * @private\n */\nfunction HttpClient(options) {\n  var isHttps = options.scheme === 'https'\n\n  // If the port is a falsy value - replace it with default one.\n  if (!options.port) {\n    options.port = isHttps ? 443 : 80\n  }\n\n  // HTTP2 adapter is applicable only if it's NodeJS env and\n  // no fetch API override provided (to preserve backward-compatibility).\n  var useHttp2Adapter = !options.fetch && util.isNodeEnv() && isHttp2Supported()\n\n  this._adapter = useHttp2Adapter\n    ? new (require('./http2Adapter'))({\n        http2SessionIdleTime: options.http2SessionIdleTime,\n      })\n    : new (require('./fetchAdapter'))({\n        isHttps: isHttps,\n        fetch: options.fetch,\n        keepAlive: options.keepAlive,\n      })\n\n  if (options.endpoint === null) {\n    this._baseUrl = options.scheme + '://' + options.domain + ':' + options.port\n  } else {\n    this._baseUrl = options.endpoint\n  }\n\n  this._secret = options.secret\n  this._headers = Object.assign({}, options.headers, getDefaultHeaders())\n  this._queryTimeout = options.queryTimeout\n  this._lastSeen = null\n  this._timeout = Math.floor(options.timeout * 1000)\n}\n\n/**\n * Returns last seen transaction time.\n *\n * @returns {number} The last seen transaction time.\n */\nHttpClient.prototype.getLastTxnTime = function() {\n  return this._lastSeen\n}\n\n/**\n * Sets the last seen transaction if the given timestamp is greater than then\n * know last seen timestamp.\n *\n * @param {number} time transaction timestamp.\n */\nHttpClient.prototype.syncLastTxnTime = function(time) {\n  if (this._lastSeen == null || this._lastSeen < time) {\n    this._lastSeen = time\n  }\n}\n\n/**\n * Cleans up any held resources.\n *\n * @param {?object} opts Close options.\n * @param {?boolean} opts.force Whether to force resources clean up.\n * @returns {Promise<void>}\n */\nHttpClient.prototype.close = function(opts) {\n  return this._adapter.close(opts)\n}\n\n/**\n * Executes an HTTP request.\n *\n * @param {?object} options Request parameters.\n * @param {?string} options.method Request method.\n * @param {?string} options.path Request path.\n * @param {?string} options.body Request body.\n * @param {?object} options.query Request query.\n * @params {?object} options.streamConsumer Stream consumer, if presented\n * the request will be \"streamed\" into streamConsumer.onData function.\n * @params {function} options.streamConsumer.onData Function called with a chunk of data.\n * @params {function} options.streamConsumer.onError Function called\n * when an error occurred.\n * when the stream is ended.\n * @param {?object} options.signal Abort signal object.\n * @param {?object} options.fetch Fetch API compatible function.\n * @param {?object} options.secret FaunaDB secret.\n * @param {?object} options.queryTimeout FaunaDB query timeout.\n * @returns {Promise} The response promise.\n */\nHttpClient.prototype.execute = function(options) {\n  options = options || {}\n\n  var invalidStreamConsumer =\n    options.streamConsumer &&\n    (typeof options.streamConsumer.onData !== 'function' ||\n      typeof options.streamConsumer.onError !== 'function')\n\n  if (invalidStreamConsumer) {\n    return Promise.reject(new TypeError('Invalid \"streamConsumer\" provided'))\n  }\n\n  var secret = options.secret || this._secret\n  var queryTimeout = options.queryTimeout || this._queryTimeout\n  var headers = this._headers\n\n  headers['Authorization'] = secret && secretHeader(secret)\n  headers['X-Last-Seen-Txn'] = this._lastSeen\n  headers['X-Query-Timeout'] = queryTimeout\n\n  return this._adapter.execute({\n    origin: this._baseUrl,\n    path: options.path || '/',\n    query: options.query,\n    method: options.method || 'GET',\n    headers: util.removeNullAndUndefinedValues(headers),\n    body: options.body,\n    signal: options.signal,\n    timeout: this._timeout,\n    streamConsumer: options.streamConsumer,\n  })\n}\n\nfunction secretHeader(secret) {\n  return 'Bearer ' + secret\n}\n\n/** @ignore */\nfunction getDefaultHeaders() {\n  var driverEnv = {\n    driver: ['javascript', packageJson.version].join('-'),\n  }\n\n  var isServiceWorker\n\n  try {\n    isServiceWorker = global instanceof ServiceWorkerGlobalScope\n  } catch (error) {\n    isServiceWorker = false\n  }\n\n  try {\n    if (util.isNodeEnv()) {\n      driverEnv.runtime = ['nodejs', process.version].join('-')\n      driverEnv.env = util.getNodeRuntimeEnv()\n      var os = require('os')\n      driverEnv.os = [os.platform(), os.release()].join('-')\n    } else if (isServiceWorker) {\n      driverEnv.runtime = 'Service Worker'\n    } else {\n      driverEnv.runtime = util.getBrowserDetails()\n      driverEnv.env = 'browser'\n      driverEnv.os = getBrowserOsDetails()\n    }\n  } catch (_) {}\n\n  var headers = {\n    'X-FaunaDB-API-Version': packageJson.apiVersion,\n  }\n\n  // TODO: api cors must be enabled to accept header X-Driver-Env\n  if (util.isNodeEnv()) {\n    headers['X-Driver-Env'] = Object.keys(driverEnv)\n      .map(key => [key, driverEnv[key].toLowerCase()].join('='))\n      .join('; ')\n  }\n  return headers\n}\n\nfunction isHttp2Supported() {\n  try {\n    require('http2')\n\n    return true\n  } catch (_) {\n    return false\n  }\n}\n\nmodule.exports = {\n  HttpClient: HttpClient,\n  TimeoutError: errors.TimeoutError,\n  AbortError: errors.AbortError,\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}